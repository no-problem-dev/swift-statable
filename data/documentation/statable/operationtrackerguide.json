{"hierarchy":{"paths":[["doc:\/\/Statable\/documentation\/Statable"]]},"sections":[],"abstract":[{"text":"複数の並行操作を個別に追跡する方法を学びます。","type":"text"}],"schemaVersion":{"patch":0,"major":0,"minor":3},"primaryContentSections":[{"content":[{"type":"heading","level":2,"anchor":"Overview","text":"Overview"},{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"OperationTracker<Op>"},{"type":"text","text":"は、複数の並行操作を個別に追跡するための状態管理クラスです。"},{"type":"text","text":" "},{"type":"text","text":"例えば「データ取得中」と「保存中」を同時に追跡し、それぞれの状態に応じたUIを表示できます。"}]},{"type":"heading","level":2,"anchor":"%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BD%BF%E3%81%84%E6%96%B9","text":"基本的な使い方"},{"type":"heading","level":3,"anchor":"%E6%93%8D%E4%BD%9C%E3%81%AE%E5%AE%9A%E7%BE%A9","text":"操作の定義"},{"type":"paragraph","inlineContent":[{"type":"text","text":"まず、追跡したい操作をenumで定義します："}]},{"type":"codeListing","code":["enum DataOperation: String, CaseIterable, Sendable {","    case fetch      \/\/ データ取得","    case save       \/\/ 保存","    case delete     \/\/ 削除","}"],"syntax":"swift"},{"type":"heading","level":3,"anchor":"Store%E3%81%B8%E3%81%AE%E7%B5%84%E3%81%BF%E8%BE%BC%E3%81%BF","text":"Storeへの組み込み"},{"type":"paragraph","inlineContent":[{"code":"@Statable","type":"codeVoice"},{"text":"マクロの","type":"text"},{"code":"operations","type":"codeVoice"},{"text":"パラメータで操作型を指定します：","type":"text"}]},{"type":"codeListing","code":["@Statable([Item].self, operations: DataOperation.self)","@MainActor @Observable","final class ItemStore {","    public init() {}","}"],"syntax":"swift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"これにより、"},{"type":"codeVoice","code":"operations"},{"type":"text","text":"プロパティが自動生成されます。"}]},{"type":"heading","level":2,"anchor":"%E6%93%8D%E4%BD%9C%E3%83%A9%E3%82%A4%E3%83%95%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB","text":"操作ライフサイクル"},{"type":"heading","level":3,"anchor":"%E6%89%8B%E5%8B%95%E7%AE%A1%E7%90%86","text":"手動管理"},{"type":"codeListing","code":["\/\/ 操作開始","store.operations.start(.fetch)","","\/\/ 操作完了","store.operations.complete(.fetch)","","\/\/ 操作失敗","store.operations.fail(.fetch, with: error)"],"syntax":"swift"},{"type":"heading","level":3,"anchor":"%E8%87%AA%E5%8B%95%E7%AE%A1%E7%90%86%E6%8E%A8%E5%A5%A8","text":"自動管理（推奨）"},{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"run"},{"type":"text","text":"メソッドを使用すると、開始・完了・失敗を自動的に管理できます："}]},{"type":"codeListing","code":["\/\/ 基本的な使い方","let result = await store.operations.run(.fetch) {","    try await api.fetchItems()","}","","switch result {","case .success(let items):","    store.set(items)","case .failure(let error):","    \/\/ エラーハンドリング（既にoperationsにはエラーが記録されている）","}"],"syntax":"swift"},{"type":"heading","level":3,"anchor":"AsyncValue%E3%81%A8%E3%81%AE%E9%80%A3%E6%90%BA","text":"AsyncValueとの連携"},{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"run(_:into:task:)"},{"text":"メソッドで、操作結果を直接AsyncValueに設定できます：","type":"text"}]},{"type":"codeListing","code":["await store.operations.run(.fetch, into: store._asyncValue) {","    try await api.fetchItems()","}","\/\/ これにより、store.valueが自動的に更新される"],"syntax":"swift"},{"type":"heading","level":2,"anchor":"%E7%8A%B6%E6%85%8B%E3%81%AE%E7%A2%BA%E8%AA%8D","text":"状態の確認"},{"type":"heading","level":3,"anchor":"%E5%80%8B%E5%88%A5%E3%81%AE%E6%93%8D%E4%BD%9C","text":"個別の操作"},{"type":"codeListing","code":["\/\/ 特定の操作が実行中か","if store.operations.isActive(.save) {","    ProgressView(\"保存中...\")","}","","\/\/ 特定の操作のエラー","if let error = store.operations.error(for: .fetch) {","    Text(\"取得エラー: \\(error.message)\")","}"],"syntax":"swift"},{"type":"heading","level":3,"anchor":"%E5%85%A8%E4%BD%93%E3%81%AE%E7%8A%B6%E6%85%8B","text":"全体の状態"},{"type":"codeListing","code":["\/\/ いずれかの操作が実行中か","if store.operations.hasActiveOperations {","    \/\/ 何らかの処理中","}","","\/\/ 実行中の操作一覧","for operation in store.operations.active {","    print(\"\\(operation) is running\")","}","","\/\/ エラーがあるか","if store.operations.hasErrors {","    \/\/ エラー一覧を表示","    for (op, error) in store.operations.allErrors {","        print(\"\\(op): \\(error.message)\")","    }","}"],"syntax":"swift"},{"type":"heading","level":2,"anchor":"%E3%82%A8%E3%83%A9%E3%83%BC%E7%AE%A1%E7%90%86","text":"エラー管理"},{"type":"codeListing","code":["\/\/ 特定の操作のエラーをクリア","store.operations.clearError(for: .fetch)","","\/\/ 全てのエラーをクリア","store.operations.clearAllErrors()"],"syntax":"swift"},{"type":"heading","level":2,"anchor":"%E5%AE%9F%E8%B7%B5%E7%9A%84%E3%81%AA%E4%BE%8B","text":"実践的な例"},{"type":"heading","level":3,"anchor":"CRUD%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3","text":"CRUDアプリケーション"},{"type":"codeListing","code":["enum TodoOperation: String, CaseIterable, Sendable {","    case fetch, create, update, delete","}","","@Statable([Todo].self, operations: TodoOperation.self)","@MainActor @Observable","final class TodoStore {","    public init() {}","","    var isModifying: Bool {","        operations.isActive(.create) ||","        operations.isActive(.update) ||","        operations.isActive(.delete)","    }","}","","struct TodoListView: View {","    @Environment(TodoStore.self) private var store","","    var body: some View {","        List {","            if store.operations.isActive(.fetch) {","                ProgressView(\"読み込み中...\")","            }","","            ForEach(store.value ?? []) { todo in","                TodoRow(todo: todo)","            }","            .deleteDisabled(store.isModifying)","        }","        .toolbar {","            if store.isModifying {","                ProgressView()","            }","        }","        .task {","            await store.operations.run(.fetch, into: store._asyncValue) {","                try await api.fetchTodos()","            }","        }","    }","}"],"syntax":"swift"},{"type":"heading","level":3,"anchor":"%E8%A4%87%E6%95%B0%E3%81%AE%E7%8B%AC%E7%AB%8B%E3%81%97%E3%81%9F%E6%93%8D%E4%BD%9C","text":"複数の独立した操作"},{"type":"codeListing","code":["\/\/ 同時に複数の操作を実行","await withTaskGroup(of: Void.self) { group in","    group.addTask {","        await store.operations.run(.fetchProfile) {","            try await api.fetchProfile()","        }","    }","    group.addTask {","        await store.operations.run(.fetchSettings) {","            try await api.fetchSettings()","        }","    }","}"],"syntax":"swift"},{"type":"heading","level":2,"anchor":"%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9","text":"ベストプラクティス"},{"type":"heading","level":3,"anchor":"%E6%93%8D%E4%BD%9C%E3%81%AE%E7%B2%92%E5%BA%A6","text":"操作の粒度"},{"type":"paragraph","inlineContent":[{"text":"操作は、UIで個別に状態を表示する必要があるかどうかで粒度を決めます：","type":"text"}]},{"type":"codeListing","code":["\/\/ 良い例：UIで個別に表示が必要","enum GoodOperations {","    case fetchList      \/\/ リスト取得中","    case saveItem       \/\/ アイテム保存中","    case deleteItem     \/\/ アイテム削除中","}","","\/\/ 悪い例：粒度が細かすぎる","enum BadOperations {","    case fetchListStart","    case fetchListProcess","    case fetchListComplete  \/\/ 状態遷移は自動管理されるべき","}"],"syntax":"swift"},{"type":"heading","level":3,"anchor":"%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AA%E3%83%B3%E3%82%B0","text":"エラーハンドリング"},{"type":"codeListing","code":["\/\/ 操作失敗時のリトライUI","if let error = store.operations.error(for: .fetch) {","    VStack {","        Text(error.message)","        Button(\"再試行\") {","            store.operations.clearError(for: .fetch)","            Task {","                await store.operations.run(.fetch) { ... }","            }","        }","    }","}"],"syntax":"swift"},{"type":"heading","level":2,"anchor":"%E9%96%A2%E9%80%A3%E9%A0%85%E7%9B%AE","text":"関連項目"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"reference","identifier":"doc:\/\/Statable\/documentation\/Statable\/OperationTracker","isActive":true}]}]},{"content":[{"inlineContent":[{"identifier":"doc:\/\/Statable\/documentation\/Statable\/StateError","isActive":true,"type":"reference"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"isActive":true,"identifier":"doc:\/\/Statable\/documentation\/Statable\/GettingStarted","type":"reference"}],"type":"paragraph"}]}]}],"kind":"content"}],"seeAlsoSections":[{"generated":true,"title":"操作トラッキング","identifiers":["doc:\/\/Statable\/documentation\/Statable\/OperationTracker"],"anchor":"操作トラッキング"}],"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/statable\/operationtrackerguide"]}],"identifier":{"url":"doc:\/\/Statable\/documentation\/Statable\/OperationTrackerGuide","interfaceLanguage":"swift"},"kind":"article","metadata":{"modules":[{"name":"Statable"}],"roleHeading":"Article","title":"OperationTracker ガイド","role":"article"},"references":{"doc://Statable/documentation/Statable/OperationTracker":{"url":"\/documentation\/statable\/operationtracker","kind":"symbol","title":"OperationTracker","abstract":[{"type":"text","text":"複数の並行操作を追跡するための状態管理"}],"role":"symbol","identifier":"doc:\/\/Statable\/documentation\/Statable\/OperationTracker","navigatorTitle":[{"kind":"identifier","text":"OperationTracker"}],"type":"topic","fragments":[{"kind":"keyword","text":"class"},{"kind":"text","text":" "},{"kind":"identifier","text":"OperationTracker"}]},"doc://Statable/documentation/Statable/GettingStarted":{"type":"topic","abstract":[{"type":"text","text":"Statableを使って非同期状態を管理する基本的な方法を学びます。"}],"title":"はじめに","role":"article","url":"\/documentation\/statable\/gettingstarted","identifier":"doc:\/\/Statable\/documentation\/Statable\/GettingStarted","kind":"article"},"doc://Statable/documentation/Statable":{"url":"\/documentation\/statable","kind":"symbol","title":"Statable","identifier":"doc:\/\/Statable\/documentation\/Statable","role":"collection","type":"topic","abstract":[{"type":"text","text":"SwiftUI向けの宣言的な状態管理マクロライブラリ。"}]},"doc://Statable/documentation/Statable/StateError":{"kind":"symbol","type":"topic","role":"symbol","fragments":[{"text":"enum","kind":"keyword"},{"text":" ","kind":"text"},{"text":"StateError","kind":"identifier"}],"abstract":[{"text":"状態管理で扱う構造化エラー","type":"text"}],"url":"\/documentation\/statable\/stateerror","identifier":"doc:\/\/Statable\/documentation\/Statable\/StateError","navigatorTitle":[{"text":"StateError","kind":"identifier"}],"title":"StateError"}}}