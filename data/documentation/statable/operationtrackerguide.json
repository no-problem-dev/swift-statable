{"sections":[],"hierarchy":{"paths":[["doc:\/\/Statable\/documentation\/Statable"]]},"schemaVersion":{"patch":0,"major":0,"minor":3},"metadata":{"role":"article","title":"OperationTracker ガイド","modules":[{"name":"Statable"}],"roleHeading":"Article"},"seeAlsoSections":[{"generated":true,"title":"操作トラッキング","identifiers":["doc:\/\/Statable\/documentation\/Statable\/OperationTracker"],"anchor":"操作トラッキング"}],"abstract":[{"text":"複数の並行操作を個別に追跡する方法を学びます。","type":"text"}],"primaryContentSections":[{"kind":"content","content":[{"anchor":"Overview","text":"Overview","level":2,"type":"heading"},{"inlineContent":[{"code":"OperationTracker<Op>","type":"codeVoice"},{"type":"text","text":"は、複数の並行操作を個別に追跡するための状態管理クラスです。"},{"type":"text","text":" "},{"type":"text","text":"例えば「データ取得中」と「保存中」を同時に追跡し、それぞれの状態に応じたUIを表示できます。"}],"type":"paragraph"},{"anchor":"%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BD%BF%E3%81%84%E6%96%B9","text":"基本的な使い方","level":2,"type":"heading"},{"anchor":"%E6%93%8D%E4%BD%9C%E3%81%AE%E5%AE%9A%E7%BE%A9","text":"操作の定義","level":3,"type":"heading"},{"inlineContent":[{"type":"text","text":"まず、追跡したい操作をenumで定義します："}],"type":"paragraph"},{"syntax":"swift","code":["enum DataOperation: String, CaseIterable, Sendable {","    case fetch      \/\/ データ取得","    case save       \/\/ 保存","    case delete     \/\/ 削除","}"],"type":"codeListing"},{"anchor":"Store%E3%81%B8%E3%81%AE%E7%B5%84%E3%81%BF%E8%BE%BC%E3%81%BF","text":"Storeへの組み込み","level":3,"type":"heading"},{"inlineContent":[{"type":"codeVoice","code":"@Statable"},{"type":"text","text":"マクロの"},{"type":"codeVoice","code":"operations"},{"type":"text","text":"パラメータで操作型を指定します："}],"type":"paragraph"},{"syntax":"swift","code":["@Statable([Item].self, operations: DataOperation.self)","@MainActor @Observable","final class ItemStore {","    public init() {}","}"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"これにより、"},{"type":"codeVoice","code":"operations"},{"type":"text","text":"プロパティが自動生成されます。"}],"type":"paragraph"},{"anchor":"%E6%93%8D%E4%BD%9C%E3%83%A9%E3%82%A4%E3%83%95%E3%82%B5%E3%82%A4%E3%82%AF%E3%83%AB","text":"操作ライフサイクル","level":2,"type":"heading"},{"anchor":"%E6%89%8B%E5%8B%95%E7%AE%A1%E7%90%86","text":"手動管理","level":3,"type":"heading"},{"syntax":"swift","code":["\/\/ 操作開始","store.operations.start(.fetch)","","\/\/ 操作完了","store.operations.complete(.fetch)","","\/\/ 操作失敗","store.operations.fail(.fetch, with: error)"],"type":"codeListing"},{"anchor":"%E8%87%AA%E5%8B%95%E7%AE%A1%E7%90%86%E6%8E%A8%E5%A5%A8","text":"自動管理（推奨）","level":3,"type":"heading"},{"inlineContent":[{"code":"run","type":"codeVoice"},{"text":"メソッドを使用すると、開始・完了・失敗を自動的に管理できます：","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["\/\/ 基本的な使い方","let result = await store.operations.run(.fetch) {","    try await api.fetchItems()","}","","switch result {","case .success(let items):","    store.set(items)","case .failure(let error):","    \/\/ エラーハンドリング（既にoperationsにはエラーが記録されている）","}"],"type":"codeListing"},{"anchor":"AsyncValue%E3%81%A8%E3%81%AE%E9%80%A3%E6%90%BA","text":"AsyncValueとの連携","level":3,"type":"heading"},{"inlineContent":[{"code":"run(_:into:task:)","type":"codeVoice"},{"text":"メソッドで、操作結果を直接AsyncValueに設定できます：","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["await store.operations.run(.fetch, into: store._asyncValue) {","    try await api.fetchItems()","}","\/\/ これにより、store.valueが自動的に更新される"],"type":"codeListing"},{"anchor":"%E7%8A%B6%E6%85%8B%E3%81%AE%E7%A2%BA%E8%AA%8D","text":"状態の確認","level":2,"type":"heading"},{"anchor":"%E5%80%8B%E5%88%A5%E3%81%AE%E6%93%8D%E4%BD%9C","text":"個別の操作","level":3,"type":"heading"},{"syntax":"swift","code":["\/\/ 特定の操作が実行中か","if store.operations.isActive(.save) {","    ProgressView(\"保存中...\")","}","","\/\/ 特定の操作のエラー","if let error = store.operations.error(for: .fetch) {","    Text(\"取得エラー: \\(error.message)\")","}"],"type":"codeListing"},{"level":3,"text":"全体の状態","anchor":"%E5%85%A8%E4%BD%93%E3%81%AE%E7%8A%B6%E6%85%8B","type":"heading"},{"code":["\/\/ いずれかの操作が実行中か","if store.operations.hasActiveOperations {","    \/\/ 何らかの処理中","}","","\/\/ 実行中の操作一覧","for operation in store.operations.active {","    print(\"\\(operation) is running\")","}","","\/\/ エラーがあるか","if store.operations.hasErrors {","    \/\/ エラー一覧を表示","    for (op, error) in store.operations.allErrors {","        print(\"\\(op): \\(error.message)\")","    }","}"],"syntax":"swift","type":"codeListing"},{"level":2,"text":"エラー管理","anchor":"%E3%82%A8%E3%83%A9%E3%83%BC%E7%AE%A1%E7%90%86","type":"heading"},{"code":["\/\/ 特定の操作のエラーをクリア","store.operations.clearError(for: .fetch)","","\/\/ 全てのエラーをクリア","store.operations.clearAllErrors()"],"syntax":"swift","type":"codeListing"},{"level":2,"text":"実践的な例","anchor":"%E5%AE%9F%E8%B7%B5%E7%9A%84%E3%81%AA%E4%BE%8B","type":"heading"},{"level":3,"text":"CRUDアプリケーション","anchor":"CRUD%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3","type":"heading"},{"code":["enum TodoOperation: String, CaseIterable, Sendable {","    case fetch, create, update, delete","}","","@Statable([Todo].self, operations: TodoOperation.self)","@MainActor @Observable","final class TodoStore {","    public init() {}","","    var isModifying: Bool {","        operations.isActive(.create) ||","        operations.isActive(.update) ||","        operations.isActive(.delete)","    }","}","","struct TodoListView: View {","    @Environment(TodoStore.self) private var store","","    var body: some View {","        List {","            if store.operations.isActive(.fetch) {","                ProgressView(\"読み込み中...\")","            }","","            ForEach(store.value ?? []) { todo in","                TodoRow(todo: todo)","            }","            .deleteDisabled(store.isModifying)","        }","        .toolbar {","            if store.isModifying {","                ProgressView()","            }","        }","        .task {","            await store.operations.run(.fetch, into: store._asyncValue) {","                try await api.fetchTodos()","            }","        }","    }","}"],"syntax":"swift","type":"codeListing"},{"level":3,"text":"複数の独立した操作","anchor":"%E8%A4%87%E6%95%B0%E3%81%AE%E7%8B%AC%E7%AB%8B%E3%81%97%E3%81%9F%E6%93%8D%E4%BD%9C","type":"heading"},{"code":["\/\/ 同時に複数の操作を実行","await withTaskGroup(of: Void.self) { group in","    group.addTask {","        await store.operations.run(.fetchProfile) {","            try await api.fetchProfile()","        }","    }","    group.addTask {","        await store.operations.run(.fetchSettings) {","            try await api.fetchSettings()","        }","    }","}"],"syntax":"swift","type":"codeListing"},{"level":2,"text":"ベストプラクティス","anchor":"%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9","type":"heading"},{"level":3,"text":"操作の粒度","anchor":"%E6%93%8D%E4%BD%9C%E3%81%AE%E7%B2%92%E5%BA%A6","type":"heading"},{"inlineContent":[{"text":"操作は、UIで個別に状態を表示する必要があるかどうかで粒度を決めます：","type":"text"}],"type":"paragraph"},{"code":["\/\/ 良い例：UIで個別に表示が必要","enum GoodOperations {","    case fetchList      \/\/ リスト取得中","    case saveItem       \/\/ アイテム保存中","    case deleteItem     \/\/ アイテム削除中","}","","\/\/ 悪い例：粒度が細かすぎる","enum BadOperations {","    case fetchListStart","    case fetchListProcess","    case fetchListComplete  \/\/ 状態遷移は自動管理されるべき","}"],"syntax":"swift","type":"codeListing"},{"level":3,"text":"エラーハンドリング","anchor":"%E3%82%A8%E3%83%A9%E3%83%BC%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AA%E3%83%B3%E3%82%B0","type":"heading"},{"code":["\/\/ 操作失敗時のリトライUI","if let error = store.operations.error(for: .fetch) {","    VStack {","        Text(error.message)","        Button(\"再試行\") {","            store.operations.clearError(for: .fetch)","            Task {","                await store.operations.run(.fetch) { ... }","            }","        }","    }","}"],"syntax":"swift","type":"codeListing"},{"level":2,"text":"関連項目","anchor":"%E9%96%A2%E9%80%A3%E9%A0%85%E7%9B%AE","type":"heading"},{"items":[{"content":[{"inlineContent":[{"identifier":"doc:\/\/Statable\/documentation\/Statable\/OperationTracker","isActive":true,"type":"reference"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"identifier":"doc:\/\/Statable\/documentation\/Statable\/StateError","type":"reference","isActive":true}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"reference","identifier":"doc:\/\/Statable\/documentation\/Statable\/GettingStarted","isActive":true}]}]}],"type":"unorderedList"}]}],"variants":[{"paths":["\/documentation\/statable\/operationtrackerguide"],"traits":[{"interfaceLanguage":"swift"}]}],"kind":"article","identifier":{"interfaceLanguage":"swift","url":"doc:\/\/Statable\/documentation\/Statable\/OperationTrackerGuide"},"references":{"doc://Statable/documentation/Statable":{"url":"\/documentation\/statable","role":"collection","type":"topic","abstract":[{"text":"SwiftUI向けの宣言的な状態管理マクロライブラリ。","type":"text"}],"identifier":"doc:\/\/Statable\/documentation\/Statable","kind":"symbol","title":"Statable"},"doc://Statable/documentation/Statable/StateError":{"identifier":"doc:\/\/Statable\/documentation\/Statable\/StateError","url":"\/documentation\/statable\/stateerror","title":"StateError","type":"topic","kind":"symbol","abstract":[{"type":"text","text":"状態管理で扱う構造化エラー"}],"role":"symbol","fragments":[{"kind":"keyword","text":"enum"},{"kind":"text","text":" "},{"kind":"identifier","text":"StateError"}],"navigatorTitle":[{"kind":"identifier","text":"StateError"}]},"doc://Statable/documentation/Statable/OperationTracker":{"identifier":"doc:\/\/Statable\/documentation\/Statable\/OperationTracker","kind":"symbol","title":"OperationTracker","abstract":[{"type":"text","text":"複数の並行操作を追跡するための状態管理"}],"type":"topic","navigatorTitle":[{"text":"OperationTracker","kind":"identifier"}],"url":"\/documentation\/statable\/operationtracker","role":"symbol","fragments":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"text":"OperationTracker","kind":"identifier"}]},"doc://Statable/documentation/Statable/GettingStarted":{"role":"article","title":"はじめに","identifier":"doc:\/\/Statable\/documentation\/Statable\/GettingStarted","kind":"article","abstract":[{"type":"text","text":"Statableを使って非同期状態を管理する基本的な方法を学びます。"}],"url":"\/documentation\/statable\/gettingstarted","type":"topic"}}}