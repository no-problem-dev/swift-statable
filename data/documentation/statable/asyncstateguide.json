{"variants":[{"paths":["\/documentation\/statable\/asyncstateguide"],"traits":[{"interfaceLanguage":"swift"}]}],"abstract":[{"text":"排他的な非同期状態表現の詳細な使い方を学びます。","type":"text"}],"kind":"article","schemaVersion":{"minor":3,"major":0,"patch":0},"hierarchy":{"paths":[["doc:\/\/Statable\/documentation\/Statable"]]},"identifier":{"url":"doc:\/\/Statable\/documentation\/Statable\/AsyncStateGuide","interfaceLanguage":"swift"},"sections":[],"metadata":{"modules":[{"name":"Statable"}],"roleHeading":"Article","role":"article","title":"AsyncState ガイド"},"primaryContentSections":[{"content":[{"anchor":"Overview","level":2,"text":"Overview","type":"heading"},{"type":"paragraph","inlineContent":[{"code":"AsyncState<T>","type":"codeVoice"},{"text":"は、非同期でロードされる値の状態を排他的に表現するenumです。","type":"text"},{"text":" ","type":"text"},{"text":"SSOT（Single Source of Truth）原則に基づき、1つのenumで全ての状態を排他的に表現します。","type":"text"}]},{"anchor":"%E7%8A%B6%E6%85%8B%E3%81%AE%E7%A8%AE%E9%A1%9E","level":2,"text":"状態の種類","type":"heading"},{"syntax":"swift","type":"codeListing","code":["public enum AsyncState<Value: Sendable>: Sendable {","    case idle                       \/\/ 初期状態","    case loading(previous: Value?)  \/\/ ロード中（前回の値を保持可能）","    case loaded(Value)              \/\/ ロード成功","    case failed(StateError)         \/\/ ロード失敗","}"]},{"anchor":"idle-%E5%88%9D%E6%9C%9F%E7%8A%B6%E6%85%8B","level":3,"text":"idle - 初期状態","type":"heading"},{"type":"paragraph","inlineContent":[{"text":"まだデータがロードされていない状態です。アプリ起動直後や、","type":"text"},{"text":" ","type":"text"},{"text":"明示的にリセットした後の状態がこれに該当します。","type":"text"}]},{"syntax":"swift","type":"codeListing","code":["if store.isIdle {","    Text(\"データ未取得\")","}"]},{"anchor":"loading-%E3%83%AD%E3%83%BC%E3%83%89%E4%B8%AD","level":3,"text":"loading - ロード中","type":"heading"},{"type":"paragraph","inlineContent":[{"type":"text","text":"データを取得中の状態です。"},{"type":"codeVoice","code":"previous"},{"type":"text","text":"パラメータにより、"},{"type":"text","text":" "},{"type":"text","text":"リロード時に前回の値を保持できます。これにより、"},{"type":"text","text":" "},{"type":"text","text":"ローディング中も前回のデータを表示し続けるUXが可能になります。"}]},{"syntax":"swift","type":"codeListing","code":["case .loading(let previous):","    VStack {","        ProgressView()","        if let prev = previous {","            \/\/ リロード中も前回のデータを薄く表示","            ContentView(data: prev)","                .opacity(0.5)","        }","    }"]},{"anchor":"loaded-%E3%83%AD%E3%83%BC%E3%83%89%E6%88%90%E5%8A%9F","level":3,"text":"loaded - ロード成功","type":"heading"},{"type":"paragraph","inlineContent":[{"type":"text","text":"データの取得に成功した状態です。"},{"type":"text","text":" "},{"type":"text","text":"値に直接アクセスできます。"}]},{"type":"codeListing","code":["case .loaded(let profile):","    ProfileView(profile: profile)"],"syntax":"swift"},{"type":"heading","anchor":"failed-%E3%83%AD%E3%83%BC%E3%83%89%E5%A4%B1%E6%95%97","level":3,"text":"failed - ロード失敗"},{"type":"paragraph","inlineContent":[{"type":"text","text":"エラーが発生した状態です。"},{"type":"text","text":" "},{"code":"StateError","type":"codeVoice"},{"type":"text","text":"にはエラーの詳細情報が含まれます。"}]},{"type":"codeListing","code":["case .failed(let error):","    VStack {","        Image(systemName: \"exclamationmark.triangle\")","        Text(error.message)","        Button(\"再試行\") {","            Task { await store.reload { ... } }","        }","    }"],"syntax":"swift"},{"type":"heading","anchor":"%E4%BE%BF%E5%88%A9%E3%81%AA%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3","level":2,"text":"便利なプロパティ"},{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"AsyncState"},{"type":"text","text":"には状態を簡単に確認するためのプロパティがあります："}]},{"type":"table","header":"row","rows":[[[{"type":"paragraph","inlineContent":[{"text":"プロパティ","type":"text"}]}],[{"type":"paragraph","inlineContent":[{"text":"説明","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"value"}]}],[{"type":"paragraph","inlineContent":[{"text":"現在の値（","type":"text"},{"code":"loaded","type":"codeVoice"},{"text":"または","type":"text"},{"code":"loading","type":"codeVoice"},{"text":"の","type":"text"},{"code":"previous","type":"codeVoice"},{"text":"）","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"isLoading"}]}],[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"loading"},{"type":"text","text":"状態かどうか"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"isIdle"}]}],[{"type":"paragraph","inlineContent":[{"code":"idle","type":"codeVoice"},{"type":"text","text":"状態かどうか"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"isFailed"}]}],[{"type":"paragraph","inlineContent":[{"code":"failed","type":"codeVoice"},{"text":"状態かどうか","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"hasValue"}]}],[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"loaded"},{"text":"状態かどうか","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"code":"error","type":"codeVoice"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"エラー（"},{"type":"codeVoice","code":"failed"},{"type":"text","text":"状態の場合のみ）"}]}]]]},{"type":"heading","anchor":"AsyncValue","level":2,"text":"AsyncValue"},{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"AsyncValue<T>"},{"type":"text","text":"は、"},{"type":"codeVoice","code":"AsyncState<T>"},{"type":"text","text":"を内部で保持する"},{"type":"codeVoice","code":"@Observable"},{"type":"text","text":"なラッパークラスです。"},{"type":"text","text":" "},{"type":"codeVoice","code":"@Statable"},{"type":"text","text":"マクロはこれを内部で使用しています。"}]},{"type":"heading","text":"状態遷移メソッド","level":3,"anchor":"%E7%8A%B6%E6%85%8B%E9%81%B7%E7%A7%BB%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89"},{"syntax":"swift","type":"codeListing","code":["\/\/ 値を設定（loaded状態に遷移）","store.set(newProfile)","","\/\/ エラーを設定（failed状態に遷移）","store.setError(StateError(code: \"NOT_FOUND\", message: \"見つかりません\"))","","\/\/ ローディング開始（loading状態に遷移）","store.startLoading()","","\/\/ 初期状態にリセット（idle状態に遷移）","store.reset()"]},{"type":"heading","text":"便利メソッド","level":3,"anchor":"%E4%BE%BF%E5%88%A9%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89"},{"syntax":"swift","type":"codeListing","code":["\/\/ 非同期操作を実行し、結果を状態に反映","await store.load {","    try await api.fetchProfile()","}","","\/\/ 値がない場合のみロード","await store.loadIfNeeded {","    try await api.fetchProfile()","}","","\/\/ 強制リロード","await store.reload {","    try await api.fetchProfile()","}"]},{"type":"heading","text":"ベストプラクティス","level":2,"anchor":"%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9"},{"type":"heading","text":"switch文での完全なハンドリング","level":3,"anchor":"switch%E6%96%87%E3%81%A7%E3%81%AE%E5%AE%8C%E5%85%A8%E3%81%AA%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AA%E3%83%B3%E3%82%B0"},{"type":"paragraph","inlineContent":[{"type":"text","text":"全ての状態を明示的にハンドリングすることで、"},{"type":"text","text":" "},{"type":"text","text":"状態の漏れを防ぎます："}]},{"syntax":"swift","type":"codeListing","code":["switch store.state {","case .idle:","    \/\/ 初期表示","case .loading(let previous):","    \/\/ ローディング表示（前回の値があれば利用）","case .loaded(let value):","    \/\/ メインコンテンツ","case .failed(let error):","    \/\/ エラー表示とリトライUI","}"]},{"type":"heading","text":"条件付きレンダリング","level":3,"anchor":"%E6%9D%A1%E4%BB%B6%E4%BB%98%E3%81%8D%E3%83%AC%E3%83%B3%E3%83%80%E3%83%AA%E3%83%B3%E3%82%B0"},{"type":"paragraph","inlineContent":[{"text":"簡単な条件分岐には便利プロパティを使用：","type":"text"}]},{"syntax":"swift","type":"codeListing","code":["if store.isLoading {","    ProgressView()","}","","if let profile = store.value {","    Text(profile.name)","}"]},{"type":"heading","text":"関連項目","level":2,"anchor":"%E9%96%A2%E9%80%A3%E9%A0%85%E7%9B%AE"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"reference","identifier":"doc:\/\/Statable\/documentation\/Statable\/AsyncState","isActive":true}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"reference","isActive":true,"identifier":"doc:\/\/Statable\/documentation\/Statable\/AsyncValue"}]}]},{"content":[{"inlineContent":[{"isActive":true,"type":"reference","identifier":"doc:\/\/Statable\/documentation\/Statable\/StateError"}],"type":"paragraph"}]}]}],"kind":"content"}],"seeAlsoSections":[{"generated":true,"identifiers":["doc:\/\/Statable\/documentation\/Statable\/AsyncState","doc:\/\/Statable\/documentation\/Statable\/AsyncValue"],"anchor":"状態管理","title":"状態管理"}],"references":{"doc://Statable/documentation/Statable/StateError":{"identifier":"doc:\/\/Statable\/documentation\/Statable\/StateError","url":"\/documentation\/statable\/stateerror","title":"StateError","type":"topic","kind":"symbol","abstract":[{"type":"text","text":"状態管理で扱う構造化エラー"}],"role":"symbol","fragments":[{"kind":"keyword","text":"enum"},{"kind":"text","text":" "},{"kind":"identifier","text":"StateError"}],"navigatorTitle":[{"kind":"identifier","text":"StateError"}]},"doc://Statable/documentation/Statable":{"url":"\/documentation\/statable","role":"collection","type":"topic","abstract":[{"text":"SwiftUI向けの宣言的な状態管理マクロライブラリ。","type":"text"}],"identifier":"doc:\/\/Statable\/documentation\/Statable","kind":"symbol","title":"Statable"},"doc://Statable/documentation/Statable/AsyncState":{"abstract":[{"type":"text","text":"非同期でロードされる値の状態を排他的に表現するenum"}],"identifier":"doc:\/\/Statable\/documentation\/Statable\/AsyncState","kind":"symbol","role":"symbol","fragments":[{"kind":"keyword","text":"enum"},{"kind":"text","text":" "},{"kind":"identifier","text":"AsyncState"}],"navigatorTitle":[{"kind":"identifier","text":"AsyncState"}],"type":"topic","title":"AsyncState","url":"\/documentation\/statable\/asyncstate"},"doc://Statable/documentation/Statable/AsyncValue":{"navigatorTitle":[{"kind":"identifier","text":"AsyncValue"}],"abstract":[{"type":"text","text":"非同期でロードされる値を管理する@Observableなラッパー"}],"identifier":"doc:\/\/Statable\/documentation\/Statable\/AsyncValue","role":"symbol","title":"AsyncValue","url":"\/documentation\/statable\/asyncvalue","fragments":[{"kind":"keyword","text":"class"},{"kind":"text","text":" "},{"kind":"identifier","text":"AsyncValue"}],"kind":"symbol","type":"topic"}}}