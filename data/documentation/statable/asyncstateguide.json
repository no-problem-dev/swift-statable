{"metadata":{"role":"article","title":"AsyncState ガイド","modules":[{"name":"Statable"}],"roleHeading":"Article"},"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/statable\/asyncstateguide"]}],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/Statable\/documentation\/Statable\/AsyncStateGuide"},"sections":[],"abstract":[{"text":"排他的な非同期状態表現の詳細な使い方を学びます。","type":"text"}],"hierarchy":{"paths":[["doc:\/\/Statable\/documentation\/Statable"]]},"schemaVersion":{"major":0,"minor":3,"patch":0},"primaryContentSections":[{"kind":"content","content":[{"text":"Overview","anchor":"Overview","type":"heading","level":2},{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"AsyncState<T>"},{"text":"は、非同期でロードされる値の状態を排他的に表現するenumです。","type":"text"},{"text":" ","type":"text"},{"text":"SSOT（Single Source of Truth）原則に基づき、1つのenumで全ての状態を排他的に表現します。","type":"text"}]},{"text":"状態の種類","anchor":"%E7%8A%B6%E6%85%8B%E3%81%AE%E7%A8%AE%E9%A1%9E","type":"heading","level":2},{"type":"codeListing","syntax":"swift","code":["public enum AsyncState<Value: Sendable>: Sendable {","    case idle                       \/\/ 初期状態","    case loading(previous: Value?)  \/\/ ロード中（前回の値を保持可能）","    case loaded(Value)              \/\/ ロード成功","    case failed(StateError)         \/\/ ロード失敗","}"]},{"text":"idle - 初期状態","anchor":"idle-%E5%88%9D%E6%9C%9F%E7%8A%B6%E6%85%8B","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"まだデータがロードされていない状態です。アプリ起動直後や、"},{"type":"text","text":" "},{"type":"text","text":"明示的にリセットした後の状態がこれに該当します。"}]},{"type":"codeListing","syntax":"swift","code":["if store.isIdle {","    Text(\"データ未取得\")","}"]},{"text":"loading - ロード中","anchor":"loading-%E3%83%AD%E3%83%BC%E3%83%89%E4%B8%AD","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"データを取得中の状態です。"},{"code":"previous","type":"codeVoice"},{"type":"text","text":"パラメータにより、"},{"type":"text","text":" "},{"type":"text","text":"リロード時に前回の値を保持できます。これにより、"},{"type":"text","text":" "},{"type":"text","text":"ローディング中も前回のデータを表示し続けるUXが可能になります。"}]},{"type":"codeListing","syntax":"swift","code":["case .loading(let previous):","    VStack {","        ProgressView()","        if let prev = previous {","            \/\/ リロード中も前回のデータを薄く表示","            ContentView(data: prev)","                .opacity(0.5)","        }","    }"]},{"text":"loaded - ロード成功","anchor":"loaded-%E3%83%AD%E3%83%BC%E3%83%89%E6%88%90%E5%8A%9F","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"text":"データの取得に成功した状態です。","type":"text"},{"text":" ","type":"text"},{"text":"値に直接アクセスできます。","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["case .loaded(let profile):","    ProfileView(profile: profile)"]},{"text":"failed - ロード失敗","anchor":"failed-%E3%83%AD%E3%83%BC%E3%83%89%E5%A4%B1%E6%95%97","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"エラーが発生した状態です。"},{"type":"text","text":" "},{"type":"codeVoice","code":"StateError"},{"type":"text","text":"にはエラーの詳細情報が含まれます。"}]},{"type":"codeListing","syntax":"swift","code":["case .failed(let error):","    VStack {","        Image(systemName: \"exclamationmark.triangle\")","        Text(error.message)","        Button(\"再試行\") {","            Task { await store.reload { ... } }","        }","    }"]},{"text":"便利なプロパティ","anchor":"%E4%BE%BF%E5%88%A9%E3%81%AA%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3","type":"heading","level":2},{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"AsyncState"},{"type":"text","text":"には状態を簡単に確認するためのプロパティがあります："}]},{"type":"table","header":"row","rows":[[[{"type":"paragraph","inlineContent":[{"text":"プロパティ","type":"text"}]}],[{"type":"paragraph","inlineContent":[{"text":"説明","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"value"}]}],[{"type":"paragraph","inlineContent":[{"type":"text","text":"現在の値（"},{"code":"loaded","type":"codeVoice"},{"type":"text","text":"または"},{"code":"loading","type":"codeVoice"},{"type":"text","text":"の"},{"code":"previous","type":"codeVoice"},{"type":"text","text":"）"}]}]],[[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"isLoading"}]}],[{"type":"paragraph","inlineContent":[{"code":"loading","type":"codeVoice"},{"text":"状態かどうか","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"code":"isIdle","type":"codeVoice"}]}],[{"type":"paragraph","inlineContent":[{"code":"idle","type":"codeVoice"},{"type":"text","text":"状態かどうか"}]}]],[[{"type":"paragraph","inlineContent":[{"code":"isFailed","type":"codeVoice"}]}],[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"failed"},{"text":"状態かどうか","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"code":"hasValue","type":"codeVoice"}]}],[{"type":"paragraph","inlineContent":[{"code":"loaded","type":"codeVoice"},{"text":"状態かどうか","type":"text"}]}]],[[{"type":"paragraph","inlineContent":[{"code":"error","type":"codeVoice"}]}],[{"type":"paragraph","inlineContent":[{"text":"エラー（","type":"text"},{"code":"failed","type":"codeVoice"},{"text":"状態の場合のみ）","type":"text"}]}]]]},{"text":"AsyncValue","anchor":"AsyncValue","type":"heading","level":2},{"type":"paragraph","inlineContent":[{"code":"AsyncValue<T>","type":"codeVoice"},{"text":"は、","type":"text"},{"code":"AsyncState<T>","type":"codeVoice"},{"text":"を内部で保持する","type":"text"},{"code":"@Observable","type":"codeVoice"},{"text":"なラッパークラスです。","type":"text"},{"text":" ","type":"text"},{"code":"@Statable","type":"codeVoice"},{"text":"マクロはこれを内部で使用しています。","type":"text"}]},{"text":"状態遷移メソッド","anchor":"%E7%8A%B6%E6%85%8B%E9%81%B7%E7%A7%BB%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89","type":"heading","level":3},{"type":"codeListing","syntax":"swift","code":["\/\/ 値を設定（loaded状態に遷移）","store.set(newProfile)","","\/\/ エラーを設定（failed状態に遷移）","store.setError(StateError(code: \"NOT_FOUND\", message: \"見つかりません\"))","","\/\/ ローディング開始（loading状態に遷移）","store.startLoading()","","\/\/ 初期状態にリセット（idle状態に遷移）","store.reset()"]},{"text":"便利メソッド","anchor":"%E4%BE%BF%E5%88%A9%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89","type":"heading","level":3},{"type":"codeListing","syntax":"swift","code":["\/\/ 非同期操作を実行し、結果を状態に反映","await store.load {","    try await api.fetchProfile()","}","","\/\/ 値がない場合のみロード","await store.loadIfNeeded {","    try await api.fetchProfile()","}","","\/\/ 強制リロード","await store.reload {","    try await api.fetchProfile()","}"]},{"text":"ベストプラクティス","anchor":"%E3%83%99%E3%82%B9%E3%83%88%E3%83%97%E3%83%A9%E3%82%AF%E3%83%86%E3%82%A3%E3%82%B9","type":"heading","level":2},{"text":"switch文での完全なハンドリング","anchor":"switch%E6%96%87%E3%81%A7%E3%81%AE%E5%AE%8C%E5%85%A8%E3%81%AA%E3%83%8F%E3%83%B3%E3%83%89%E3%83%AA%E3%83%B3%E3%82%B0","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"text":"全ての状態を明示的にハンドリングすることで、","type":"text"},{"text":" ","type":"text"},{"text":"状態の漏れを防ぎます：","type":"text"}]},{"type":"codeListing","syntax":"swift","code":["switch store.state {","case .idle:","    \/\/ 初期表示","case .loading(let previous):","    \/\/ ローディング表示（前回の値があれば利用）","case .loaded(let value):","    \/\/ メインコンテンツ","case .failed(let error):","    \/\/ エラー表示とリトライUI","}"]},{"text":"条件付きレンダリング","anchor":"%E6%9D%A1%E4%BB%B6%E4%BB%98%E3%81%8D%E3%83%AC%E3%83%B3%E3%83%80%E3%83%AA%E3%83%B3%E3%82%B0","type":"heading","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"簡単な条件分岐には便利プロパティを使用："}]},{"type":"codeListing","syntax":"swift","code":["if store.isLoading {","    ProgressView()","}","","if let profile = store.value {","    Text(profile.name)","}"]},{"text":"関連項目","anchor":"%E9%96%A2%E9%80%A3%E9%A0%85%E7%9B%AE","type":"heading","level":2},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"isActive":true,"type":"reference","identifier":"doc:\/\/Statable\/documentation\/Statable\/AsyncState"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"isActive":true,"identifier":"doc:\/\/Statable\/documentation\/Statable\/AsyncValue","type":"reference"}]}]},{"content":[{"inlineContent":[{"type":"reference","isActive":true,"identifier":"doc:\/\/Statable\/documentation\/Statable\/StateError"}],"type":"paragraph"}]}]}]}],"kind":"article","seeAlsoSections":[{"title":"状態管理","identifiers":["doc:\/\/Statable\/documentation\/Statable\/AsyncState","doc:\/\/Statable\/documentation\/Statable\/AsyncValue"],"generated":true,"anchor":"状態管理"}],"references":{"doc://Statable/documentation/Statable/AsyncValue":{"identifier":"doc:\/\/Statable\/documentation\/Statable\/AsyncValue","abstract":[{"type":"text","text":"非同期でロードされる値を管理する@Observableなラッパー"}],"title":"AsyncValue","kind":"symbol","type":"topic","role":"symbol","navigatorTitle":[{"text":"AsyncValue","kind":"identifier"}],"url":"\/documentation\/statable\/asyncvalue","fragments":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"text":"AsyncValue","kind":"identifier"}]},"doc://Statable/documentation/Statable/AsyncState":{"kind":"symbol","title":"AsyncState","identifier":"doc:\/\/Statable\/documentation\/Statable\/AsyncState","type":"topic","url":"\/documentation\/statable\/asyncstate","abstract":[{"text":"非同期でロードされる値の状態を排他的に表現するenum","type":"text"}],"role":"symbol","navigatorTitle":[{"text":"AsyncState","kind":"identifier"}],"fragments":[{"text":"enum","kind":"keyword"},{"text":" ","kind":"text"},{"text":"AsyncState","kind":"identifier"}]},"doc://Statable/documentation/Statable/StateError":{"kind":"symbol","type":"topic","role":"symbol","fragments":[{"text":"enum","kind":"keyword"},{"text":" ","kind":"text"},{"text":"StateError","kind":"identifier"}],"abstract":[{"text":"状態管理で扱う構造化エラー","type":"text"}],"url":"\/documentation\/statable\/stateerror","identifier":"doc:\/\/Statable\/documentation\/Statable\/StateError","navigatorTitle":[{"text":"StateError","kind":"identifier"}],"title":"StateError"},"doc://Statable/documentation/Statable":{"url":"\/documentation\/statable","kind":"symbol","title":"Statable","identifier":"doc:\/\/Statable\/documentation\/Statable","role":"collection","type":"topic","abstract":[{"type":"text","text":"SwiftUI向けの宣言的な状態管理マクロライブラリ。"}]}}}